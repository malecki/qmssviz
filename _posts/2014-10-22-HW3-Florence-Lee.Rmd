---
title: "Homework 3 Assignment"
author: flrnclee
output: html_document
published: false
tags: hw3
---

========================================================

## About the Data

**Data set 1:** The Pew Research Center's Internet & American Life Project, 2008 Health Questionnaire  
* N=3030
* Field dates: November 17 to December 17, 2008

**Data set 2:** The Pew Research Center's Internet & American Life Project, 2012 Health Questionnaire
* N=3000
* Field dates: August 7 to September 4, 2012

## Goal 

I am interested in exploring whether information-seeking behaviors changed among Internet users of different ages between the years of 2008 and 2012, especially in regards to health insurance information. The two surveys conveniently sandwich the implementation of the Affordable Care Act, which expanded healthcare coverage for uninsured and underinsured Americans. Major changes in public insurance plans and the approaching launch of [Healthcare.gov](http://www.healthcare.gov/) may have had a noticable impact on self-reported information-seeking behavior.

## About the Survey Questions

### 2008 Survey 
In the 2008 survey, the question of interest is Q16. It reads: 

> "Q16) Now, we'd like to ask if you've looked for information ONLINE about certain health or medical issues. Specifically, have you ever looked online for...". 

I am specifically interested in responses to Option J:

> "J. Information related to health insurance, including private insurance, Medicare or Medicaid". Survey respondents can either answer""

Possible responses include: 
* 1 = Yes, have done this
* 2 = No, have not done this
* 8 = Don't know
* 9 = Refused

It is worth noting that Q6 was only asked for people labeled as "Internet users". "Internet users" were identified as those who responded positively (1) to questions ```Q6a``` or ```Q6b```.

### 2012 Survey
In the 2012 survey, the corresponding question is Q6. It reads:

> "Q6) Now, we'd like to know if you've looked for information ONLINE about certain health or medical issues, either for yourself or someone else. Specifically, in the last 12 months, have you looked online for information about..."

I am specifically interested in responses to Option C:

> "C. Health insurance, including private insurance, Medicare or Medicaid."

* 1 = Yes, have done this
* 2 = No, have not done this
* 8 = Don't know
* 9 = Refused

It is worth noting that Q16 was only asked for people labeled as "Internet users". "Internet users" were identified as those who responded positively (1) to questions ```intuse```, ```emlocc```, or ```intmob```.

### Demographic Variables

A comparison of the data dictionaries for the 2008 and 2012 health surveys reveals that the demographic variables I will include (```hisp```, ```race```, ```age```, ```inc```) are all coded the same. I have purposely included more demographic variables than I will use in case I want to stratify by other characteristics.

(1) ```age ``` is a numeric value that corresponds to the age of the respondent if the respondent is 18 to 96 years old. 
+ "97" is used for individuals 97 years or older
+ "98" is used for "Don't know"
+ "99" is used for "Refused"

(2) ```hisp``` corresponds to a question asking whether the respondent is Hispanic or Latino.
+ 1 = "Yes"
+ 2 = "No"
+ 9 = "Don't know/refused"

(3) ```race``` corresponds to a question asking for the respondent's race. 
+ 1 = "White"
+ 2 = "Black or African-American"
+ 3 = "Asian or Pacific Islander"
+ 4 = "Mixed race"
+ 5 = "Native American/American Indian
+ 6 = "Other (specify)"
+ 7 = "Don't know/refused"

(4) ```inc``` corresponds to a self-reported total family income. 
+ 1 = "Less than $10,000"
+ 2 = "$10,000 to < $20,000"
+ 3 = "$20,000 to < $30,000"
+ 4 = "$30,000 to < $40,000"
+ 5 = "$40,000 to < $50,000"
+ 6 = "$50,000 to < $75,000"
+ 7 = "$75,000 to < $100,000"
+ 8 = "$100,000 to < $150,000"
+ 9 = "$150,000 or more"
+ 10 = "Don't know/refused"

(In the 2012 data set, "Don't know/refused" for ```inc``` are separated into 98 and 99.)

## Preparing the Data

```{r}
setwd("C:/Users/Flo/Desktop/Data Viz 2014/Assignment3")
wave1 <- read.csv("December_2008_Health_csv.csv", stringsAsFactors=FALSE)
wave2 <- read.csv("September_2012_health_csv.csv", stringsAsFactors=FALSE)
str(wave1)
str(wave2)
```

For wave1, I want to keep the unique identifier ```psraid```,  some demographic variables I can explore, the Internet use questions ```q6a``` and ```q6b```, and the question of interest ```q16j```. I want to subset by the Internet use questions to include only Internet users.

For wave2, I want to keep the unique identifier ```psraid```, some demographic variables I can explore, the Internet use questions ```intuse```, ```emlocc```, and ```intmob```, in addition to the question of interest ```q6c```. I want to subset by the Internet use questions to include only Internet users.


```{r}
vars08 <- c('psraid', 'sex', 'q6a', 'q6b', 'q16j', 'hisp', 'race', 'inc', 'age')
vars12 <- c('psraid', 'sex', 'intuse', 'emlocc', 'intmob', 'q6c', 'hisp', 'race', 'inc', 'age')
infoins08 <- subset(wave1, q6a==1|q6b==1, select=vars08)
infoins12 <- subset(wave2, intuse==1|emlocc==1|intmob==1, select=vars12)
```

We have 1650 participating Internet users in the 2008 survey and 2392 in the 2012 survey. Now, to handle missing values. 

```{r}
# Create function to spit out number of missing values.
missVal <- function(data) {
  if(sum(is.na(data))>0) {
    naSum <- sum(is.na(data))
    paste("There are", naSum, "missing values.")
  }
  else {
    print("There are no missing values.")
  }
}

missVal(infoins08)
missVal(infoins12)
```

There are no missing values. Even so, we want to treat people who answered "Don't know" or "Refused" as missing and remove them from our analysis.

```{r}
infoins08$ins <- infoins08$q16j
for (i in which(infoins08$q16j==8|infoins08$q16j==9,)){
  infoins08$ins[i]=NA
}
for (i in which(infoins08$q16j==2)){
  infoins08$ins[i]=0
}

infoins12$ins <- infoins12$q6c
for (i in which(infoins12$q6c==8|infoins12$q6c==9,)){
  infoins12$ins[i]=NA
}
for (i in which(infoins12$q6c==2)){
  infoins12$ins[i]=0
}
missVal(infoins08)
missVal(infoins12)
```

At most, we would be deleting 1 observation from the 2008 data set and 5 observations from the 2012 data set. This isn't huge number, so I am comfortable with removing those observations.

```{r}
infoins08 <- na.omit(infoins08)
infoins12 <- na.omit(infoins12)
missVal(infoins08)
missVal(infoins12)
```

## Conceptualizing a Visualization

I have a lot of demographc variables to work with, so I will explore one that really interests me. I am interested in comparing the proportion of Internet users who searched insurance information across age groups. This is driven by the fact that (1) young adults are the most prolific Internet users, and (2) the expansion of online resources might actually inspire older adults to also find health information online.

Right now, age is a numeric value, so I want to group them by meaningful age categories. All survey participants are 18 years or older.

+ Under 25 #group that may be covered by parents health insurance
+ 25 to < 45 
+ 45 to < 65
+ 65 and older #group that would be enrolled into Medicaid

I want to create a side-by-side barplot comparing % who searched for insurance information online for each age group between the two different survey years. 

```{r}
infoins08$agegrp <- infoins08$age
for (i in which(infoins08$age<25)) {
  infoins08$agegrp[i]="Under 25"
}
for (i in which(infoins08$age>=25 & infoins08$age<45)) {
  infoins08$agegrp[i]="25 to 44"
}
for (i in which(infoins08$age>=45 & infoins08$age<65)) {
  infoins08$agegrp[i]="45 to 64"
}
for (i in which(infoins08$age>=65 & infoins08$age<=97)) {
    infoins08$agegrp[i]="65 and older"
  }
for (i in which(infoins08$age==98|infoins08$age==99)) {
  infoins08$agegrp[i]=NA
}

infoins12$agegrp <- infoins12$age
for (i in which(infoins12$age<25)) {
  infoins12$agegrp[i]="Under 25"
}
for (i in which(infoins12$age>=25 & infoins12$age<45)) {
  infoins12$agegrp[i]="25 to 44"
}
for (i in which(infoins12$age>=45 & infoins12$age<65)) {
  infoins12$agegrp[i]="45 to 64"
}
for (i in which(infoins12$age>=65 & infoins12$age<=97)) {
    infoins12$agegrp[i]="65 and older"
  }
for (i in which(infoins12$age==98|infoins12$age==99)) {
  infoins12$agegrp[i]=NA
}

infoins08 <- na.omit(infoins08)
infoins12 <- na.omit(infoins12)
```

There are 1611 observations in the final 2008 data set and 2341 observations in the final 2012 data set.

## Creating a Tidy Dataset

```{r}
install.packages("reshape")
library("reshape")

# Rework 2008 survey
dat08 <- aggregate(infoins08$ins, list(infoins08$agegrp), mean)
names(dat08) <- c('agegrp', 'pct08')
dat08$agegrp <- factor(dat08$agegrp, levels=c("Under 25", "25 to 44", "45 to 64", "65 and older"))
dat08$agegrp

# Rework 2012 survey
dat12 <- aggregate(infoins12$ins, list(infoins12$agegrp), mean)
names(dat12) <- c('agegrp', 'pct12')
dat12$agegrp <- factor(dat12$agegrp, levels=c("Under 25", "25 to 44", "45 to 64", "65 and older"))

# Merge surveys
datFin <- merge(dat08, dat12, by = "agegrp")
datFinSort <- datFin[order(datFin$agegrp),]
datFinSort

# Reshape data
dataTransf <- melt(datFinSort, id="agegrp")
levels(dataTransf$variable) <- c("2008", "2012")
names(dataTransf) <- c("agegrp", "year", "percent")
dataTransf
```

## Visualize Data

```{r}
library(ggplot2)

base <- ggplot(dataTransf, aes(ymin=0, ymax=0.5, x=factor(agegrp), y=percent, fill=factor(year))) + geom_bar(stat="identity", position="dodge", width=0.3) + xlab("Age Group") + ylab("Proportion") + ggtitle("Proportion Who Searched Online for Insurance Info")

look <- theme_bw() + theme(plot.title = element_text(face = "bold", size=18), axis.title=element_text(face="bold", size=15))

palette <- c("#6495ed", "#a0522d")

colors <- scale_fill_manual(name="Years", values=palette)

axis <- ylim(0, 1.0) 

dataGraph <- base + look + colors + axis 

dataGraph
```

## Expressive Fantasy Function Calls

```{r eval=FALSE}
#Load surveys
wave1 <- loadSurvey("December_2008_Health_csv.csv")
wave2 <- loadSurvey("September_2012_health_csv.csv")

#Subset to variables
infoins08 <- subSurvey(wave1)
infoins12 <- subSurvey(wave2)

#Recode "Don't know" and "Refused" and omit these values
infoins08 <- recodeRefuseOmit(infoins08$q16j, infoins08$ins)
infoins12 <- recodeRefuseOmit(infoins12$q6c, infoins12$ins)

#Recode age
infoins08 <- recodeAgeOmit(infoins08$age, infoins08$agegrp)
infoins12 <- recodeAgeOmit(infoins12$age, infoins08$agegrps)

#Tidy Dataset
dat08 <- meanAgg(infoins08$ins, infoins08$agegrp, stringsAsFactors=TRUE)
dat08 <- meanAgg(infoins12$ins, infoins12$agegrp, stringsAsFactors=TRUE)
dat08 <- relab(dat08, colNam, ageLev)
dat12 <- relab(dat12, colNam, ageLev)
datFin <- aggDatOrder(dat08, dat12, ordervar)
dataTransf <- prepareDat(datFin)
```













