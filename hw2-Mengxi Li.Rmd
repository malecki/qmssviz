---
Title: "R Tutorial Assignment"
Author: "Mengxi Li"
Date: 10/02/2014
Output: html_document
---
========================================================
```{r}
setwd("~/Desktop")
install.packages("foreign")
library(foreign)
# Load World Values Survey Wave 4 Data
data=read.spss("WV4_Data_spss_v_2014-04-28.sav")
# Create  proportional tables from data by country
# I convert the the country variable into a string
data$v2<-as.character(data$v2)
# Create unweighted proportional tables from data
tblB <- as.data.frame(prop.table(table(data$v2,data$v235),1)*100)
tbl3 <- tblB[tblB$Var2 %in% c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"),]
tbl3$Var2 <- factor(tbl3$Var2, levels=c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"))
library(reshape2)
orderDat3 <- dcast(tbl3, Var1 ~Var2, value.var="Freq")
tblPlot3 <- melt(orderDat3, id.vars="Var1", measure.vars=c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"))
# And plot
## relevelling the levels to match the daulft colors better
tblPlot3$variable <- factor(tblPlot3$variable,levels=c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"))
library(ggplot2)
ggplot(tblPlot3, aes(x=Var1,y=value,fill=variable)) +
geom_bar(stat="identity") +
 coord_flip()
 theme(legend.position="top") +
  theme(axis.text.x = element_text(size=14),
        axis.text.y = element_text(size=14),
        legend.text = element_text(size=14))
# Repeat procedures for Data for Wave 6
data2=read.spss("WV6_Data_spss_v_2014_06_04.sav")
# Create  proportional tables from data by country
# I convert the variable into a string
data2$V2<-as.character(data2$V2)
# Create unweighted proportional tables from data
tblC <- as.data.frame(prop.table(table(data2$V2,data2$V238),1)*100)
tbl4 <- tblC[tblC$Var2 %in% c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"),]
tbl4$Var2 <- factor(tbl4$Var2, levels=c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"))
library(reshape2)
orderDat4 <- dcast(tbl4, Var1 ~Var2, value.var="Freq")
tblPlot4 <- melt(orderDat4, id.vars="Var1", measure.vars=c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"))
# And then the plot
## relevelling the levels to match the daulft colors better
tblPlot4$variable <- factor(tblPlot4$variable,levels=c("Lower class","Lower middle class","Upper class","Upper middle class","Working class"))
library(ggplot2)
ggplot(tblPlot4, aes(x=Var1,y=value,fill=variable)) +
  geom_bar(stat="identity") +
  coord_flip()
theme(legend.position="top") +
  theme(axis.text.x = element_text(size=14),
        axis.text.y = element_text(size=14),
        legend.text = element_text(size=14))
```
Sort the final data set by state population, in descending order
```
#Sort the final data set by state population, in descending order
bystate <- aggregate(pop_2006 ~ state, data = nd, sum)
newlgas<-merge(nd,bystate, by ="state")
names(newlgas)[names(newlgas)=="pop_2006.y"]<-"statepop"
newlgas.sort<-newlgas[order(-newlgas$statepop),]
newlgas
```






