---
title: "Homework 4"
author: "Yan Wang (yw2668)"
date: "November 17, 2014"
output: html_document
published: false
tags: hw4
---

####1. Describe the graph(s) you want to make. When pseudocode helps for succinctness and clarity, use it. You may also include or link to a bitmap prototype generated in R, or even svg generated by gridsvg.

I choose to use the dataset from Yelp Data Challenge, which invloves reviews data from 40000+ businesses across the country.

I intend to summarize the review numbers for each city in different years between 2006-2014, which will help us know how Yelp have developed over years in those cities.

The original dataset is pretty big, therefore I am not going to include it here. I will write the code for tidying it and then invite the tidy dataset.

```{r, eval=FALSE}
#Load data
setwd("/Users/Emily/Documents/Columbia/Data Visualization/Yelp/yelp_dataset_challenge_academic_dataset-2")
library(jsonlite)
json_file<-"yelp_academic_dataset_business.json"

#Business data
business <- fromJSON(sprintf("[%s]", paste(readLines(json_file), collapse=",")))
names(business)
#Choose the variables I want
bussub<-subset(business, select = c(business_id, categories, city, review_count, name, state, stars))
#Choose restaurant observations and dump the rest
rst <- bussub$categories %in% grep("Restaurants", bussub$categories, value = T)
biz_data <- subset(bussub, rst)

#Review data
review_file <- "yelp_academic_dataset_review.json"
review <- fromJSON(sprintf("[%s]", paste(readLines(review_file), collapse=",")))
names(review)
#Choose the variables I want
review_data <- subset(review, select = c(date, business_id))
#Merge data
data_all <- merge(biz_data, review_data, by = "business_id")

#Get the year of each review
tmp <- do.call(rbind, strsplit(data_all$date, "ï¼") )
data_all[c("year", "month", "day")] <- tmp
save(data_all, file = "data_all.Rdata")

#Select the variables I want and prepare it for aggregating
data_count1<-subset(data_all, select=c(city,review_count,year))
data_count1$review_count<-1

data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Glendale Az", replacement = "Glendale"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "DeForest", replacement = "De Forest"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Fort Mcdowell", replacement = "Fort McDowell"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Las Vegas ", replacement = "Las Vegas"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "McFarland", replacement = "Mc Farland"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "N Las Vegas", replacement = "Las Vegas"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "N. Las Vegas", replacement = "Las Vegas"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Nellis Afb", replacement = "Nellis AFB"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "NELLIS AFB", replacement = "Nellis AFB"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "North Las Vegas", replacement = "Las Vegas"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Paradise", replacement = "Paradise Valley"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Pheonix ", replacement = "Pheonix"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Phoenix Sky Harbor Center", replacement = "Pheonix"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Summerlin South", replacement = "Summerlin"))
data_count1 <- as.data.frame(sapply(data_count1, gsub, pattern = "Sun City West", replacement = "Sun City"))
save(data_count1, file="data_count1.Rdata")

#Count the numbers of reviews for each city in different years
count<-dcast(data_count1,city~year,sum,value.var="review_count")
count<-count[,-2]
names(count)[2]<-"count2006"
names(count)[3]<-"count2007"
names(count)[4]<-"count2008"
names(count)[5]<-"count2009"
names(count)[6]<-"count2010"
names(count)[7]<-"count2011"
names(count)[8]<-"count2012"
names(count)[9]<-"count2013"
names(count)[10]<-"count2014"
write.csv(count, file = "count.csv", row.names=FALSE)

#Choose the cities with 500+ reviews in 2014 as smaller number might not be representative.
count_s<-count[count$count2014>=500,]
write.csv(count_s, file = "count_s.csv", row.names=FALSE)

```


####The result dataset is as follows:
```{r}
setwd("/Users/Emily/Documents/Columbia/Data Visualization/Yelp/yelp_dataset_challenge_academic_dataset-2")
count_s<-read.csv("count_s.csv", header=T)
pdt <- data.table:::print.data.table
pdt(count_s)
```

####For the following requirments in this homework, please kindly check out the Plunker Link: 
http://plnkr.co/edit/87WLm3OmK1jRtcq8p96u?p=preview

####I will work on the interaction part next week and submit the updated version!