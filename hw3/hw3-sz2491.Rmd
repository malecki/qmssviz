---
title: "hw3-2014-10-23-sz2491"
author: "Siqian Zhu"
date: "2014-10-23"
output: html_document
published: false
tags: hw3
---

###Assignment 3

####A. Identify two surveys that you want to compare
I choose to look at two waves in the same survey, wave3 and wave 6 in World Values Survey. The time range for wave 3 is from 1995 to 1999 and wave 6 is conducted between 2010 to 2014. Basically, these two waves are 15 years away from each other. The question to be analysed is "What is the highest educational level that you have attained?". I am curious about change in people's education level in China and the United States as time pass by.

The question was asked with the wording and options below:

What is the highest educational level that you have attained?
(use functional equivalent of the following, in given society; 
IF STUDENT, CODE HIGHEST LEVEL HE/SHE EXPECTS TO COMPLETE):
 1. No formal education 
 2. Incomplete primary school 
 3. Complete primary school 
 4. Incomplete secondary school: technical/vocational type 
 5. Complete secondary school: technical/vocational type 
 6. Incomplete secondary: university-preparatory type 
 7. Complete secondary: university-preparatory type 
 8. Some university-level education, without degree 
 9. University-level education, with degree 
 0. DK/NA 

####B. Sketch and/or describe the graph(s) that you intend to make; these amount to informal research hypotheses.
I intend to make pictures of the mean value education level of different countries varies along with time, i.e. 1995 to 2010. I expect the curve to be upwards for both countries while the curve for China is lower than that for the US. 

####C. Write down the target shape of the data
{country:"China, United States", year:"1995,1996,...,2014", wave:"3,6", hiedu:"No formal education,...")

####D. Write a script that reads, transforms, prepares data for your graph.

#####set working directory and load packages

```{r}

setwd("/Users/ac/Documents/columbia/study/2014fall/datavisualization/github/qmssviz/hw3")

library(plyr)
library(reshape2)
library(ggplot2)
```

#####read data
wave3 and wave6 have all the countries.
```{r}
readdata <- function(){
load("~/Documents/columbia/study/2014fall/datavisualization/github/qmssviz/hw3/WV6_Data_rdata_v_2014_06_04.rdata")
wave6<-WV6_Data_spss_v_2014_06_04

load("~/Documents/columbia/study/2014fall/datavisualization/github/qmssviz/hw3/WV3_Data_rdata_v_2014_09_21.rdata")
wave3<-WV3_Data_rdata_v_2014_09_21
}

readdata()

```


#####sort data
choose two countries to look at. Their codes are US:840 and CN:156.
wave3a and wave6a only have variables for China and the US.
```{r}
wave3a <- subset(wave3,select=c(V1,V2,V238,V217),V2==840|V2==156)
wave6a <- subset(wave6,select=c(V1,V2,V262,V248),V2==840|V2==156)
```

#####name the data and make it ready for making graphs

```{r}

colnames(wave3a) <- c("wave","country","year","hieduc") #rename the variables
colnames(wave6a) <- c("wave","country","year","hieduc") #rename the variables

row.names(wave3a) <- NULL #delete the column row.names
row.names(wave6a) <- NULL #delete the column row.names

wave3a$hieduc=ifelse(wave3a$hieduc==-2|wave3a$hieduc==-1,0,wave3a$hieduc)
wave6a$hieduc=ifelse(wave6a$hieduc==-2|wave6a$hieduc==-1,0,wave6a$hieduc)

waveto=rbind(wave3a,wave6a) # Merge the two waves by column

waveto$educlevel[waveto$hieduc==1] <- "No formal education"
waveto$educlevel[waveto$hieduc==2] <- "Incomplete primary school"
waveto$educlevel[waveto$hieduc==3] <- "Complete primary school"
waveto$educlevel[waveto$hieduc==4] <- "Incomplete secondary school: technical/vocational type"
waveto$educlevel[waveto$hieduc==5] <- "Complete secondary school: technical/vocational type"
waveto$educlevel[waveto$hieduc==6] <- "Incomplete secondary: university-preparatory type"
waveto$educlevel[waveto$hieduc==7] <- "Complete secondary: university-preparatory type"
waveto$educlevel[waveto$hieduc==8] <- "Some university-level education, without degree"
waveto$educlevel[waveto$hieduc==9] <- "University-level education, with degree"
waveto$educlevel[waveto$hieduc==0] <- "Don'w know/NA"
table(waveto$hieduc)

waveto$countryname=ifelse(waveto$country==840,"US","China")

mean <- aggregate(waveto$hieduc, by = list(waveto$country,waveto$countryname, waveto$year), mean)
colnames(mean) <- c("country","countryname","year","educmean")

```


####E. Make it actually make your graph.

#####plot data

```{r}
educall <- ggplot(mean,aes(x=year,y=educmean))+
  geom_point(size=4,aes(color=factor(countryname)))+
  facet_wrap(~countryname)+
  stat_smooth(method="lm",se=F,fullrange=T)
print(educall)

mean$newyear=ifelse(mean$year==1995,1995,2010)
educall2 <- ggplot(mean,aes(x=newyear,y=educmean))+
  geom_point(size=4,aes(color=factor(countryname)))+
  facet_wrap(~countryname)+
  xlab("year")+
  stat_smooth(method="lm",se=F,fullrange=T)
print(educall2)
```

####F. Write expressive fantasy function calls 


readdata <- readdata() #read the data we need

selectdata <- selectwave3and6(wave3,wave6) #select the part we want in the data

compare <- compareplot(mean)

addlabel <- addlabel(waveto) 


####G. (Bonus) Write (some or all of) the functions to read, transform, and analyze the data.

```{r}
readdata <- function(){
load("~/Documents/columbia/study/2014fall/datavisualization/github/qmssviz/hw3/WV6_Data_rdata_v_2014_06_04.rdata")
wave6<-WV6_Data_spss_v_2014_06_04

load("~/Documents/columbia/study/2014fall/datavisualization/github/qmssviz/hw3/WV3_Data_rdata_v_2014_09_21.rdata")
wave3<-WV3_Data_rdata_v_2014_09_21
}

selectwave3and6 <- function(x,y){ 
wave3a <- subset(x,select=c(V1,V2,V238,V217),V2==840|V2==156)
wave6a <- subset(y,select=c(V1,V2,V262,V248),V2==840|V2==156)
}

compareplot <- function(a){
educall <- ggplot(a,aes(x=year,y=educmean))+
  geom_point(size=4,aes(color=factor(countryname)))+
  facet_wrap(~countryname)+
  stat_smooth(method="lm",se=F,fullrange=T)
print(educall)
}

addlabel <- function(x){
  x$educlevel[x$hieduc==1] <- "No formal education"
x$educlevel[x$hieduc==2] <- "Incomplete primary school"
x$educlevel[x$hieduc==3] <- "Complete primary school"
x$educlevel[x$hieduc==4] <- "Incomplete secondary school: technical/vocational type"
x$educlevel[x$hieduc==5] <- "Complete secondary school: technical/vocational type"
x$educlevel[x$hieduc==6] <- "Incomplete secondary: university-preparatory type"
x$educlevel[x$hieduc==7] <- "Complete secondary: university-preparatory type"
x$educlevel[x$hieduc==8] <- "Some university-level education, without degree"
x$educlevel[x$hieduc==9] <- "University-level education, with degree"
x$educlevel[x$hieduc==0] <- "Don'w know/NA"
} #add a label variable, a new variable, to a table
  
#to be continued
```
