---
title: "Delhi Growth Rates"
author: "Christopher Buckingham"
date: "November 29, 2014"
output: html_document
---
####Reading electricity consumption data from CSV file, aggregating into delhi-wide number, breaking into date subsets

```{r}
Source <-read.csv("loads2010-2013.csv")
require(plyr)
require(ggplot2)
```

#####Data read as "Source," now have all data, but need to aggregate to get some Dehli-wide numbers:

```{r}
Sourceagg <- aggregate(Source$mW, by=list(Source$days,Source$timeslots,Source$date), FUN=sum)
names(Sourceagg) <- c("days", "timeslots", "date", "mW")
```

#####New dataframe "Sourceagg" created that contains the total electricity consumption across all regions for each unique date + timeframe combination. Lost numeric timeslot variables in the process, will need to re-add these. First need a clean list of timeslots and corresponding point values:

```{r}
TimeslotHeaders <- c("timeslots", "timepoint")
Timeslots <- Source[TimeslotHeaders]
Cleantimeslots <- subset(Timeslots, timepoint>0 & timepoint<97, c(timeslots, timepoint))
Reallycleantimeslots <- unique(Cleantimeslots)  
```

#####Have now created "Reallycleantimeslots," which is a list comprised of two columns and 96 rows. Must now attach timepoint values to the aggregated delhi data:

```{r}
DelhiTotals <- merge(Sourceagg, Reallycleantimeslots, by=c("timeslots"))
```

#####The DelhiTotals dataframe now contains timeslot. The next step is to add a "discom" column that has a value of "total." We will then be able to merge the aggregated data with source.

```{r}
discom <- c('Total')
DelhiTotalswDiscom  <- data.frame(DelhiTotals$timeslots, DelhiTotals$days, DelhiTotals$date, DelhiTotals$mW, DelhiTotals$timepoint, discom)
names(DelhiTotalswDiscom) <- c("timeslots", "days", "date", "mW", "timepoint", "discom")
```

#####DelhiTotalswDiscom is a dataframe that has been appended with discom values of "total." Now it's time to merge the aggregated data with the original source data. Merge did not work. Will use Rbind, but will need to remove column "X" from source in order to do so.

```{r}
SourceMinusX <-data.frame(Source$timeslots, Source$days, Source$date, Source$mW, Source$timepoint, Source$discom)
names(SourceMinusX) <- c("timeslots", "days", "date", "mW", "timepoint", "discom")
DelhiDataMaster <- rbind(SourceMinusX, DelhiTotalswDiscom)
```

#####The combined master dataset looks good as indicated by the number of observations and a brief visual inspection. The erraneous timepoint issue has resurfaced. I'm not sure having accurate values of 1 through 96 for timepoints is necessary but in the interest of having a solid dataframe I will now need to go back and fix the timepoint values in the master dataset. 

```{r}
DelhiDataMasterxTimepoints <-data.frame(DelhiDataMaster$timeslots, DelhiDataMaster$days, DelhiDataMaster$date, DelhiDataMaster$mW, DelhiDataMaster$discom)
names(DelhiDataMasterxTimepoints) <- c("timeslots", "days", "date", "mW", "discom")
DelhiDataMaster <- merge(DelhiDataMasterxTimepoints, Reallycleantimeslots, by=c("timeslots"))
```

#####Looking good, lets sort by date, timepoint, and discom for good measure.

```{r}
DelhiDataMaster <- DelhiDataMaster[order(DelhiDataMaster$days, DelhiDataMaster$timepoint, DelhiDataMaster$discom),]
```

#####And.. lets get rid of the useless "row.names."

```{r}
DelhiDataMaster <-data.frame(DelhiDataMaster$timeslots, DelhiDataMaster$days, DelhiDataMaster$date, DelhiDataMaster$mW, DelhiDataMaster$discom, DelhiDataMaster$timepoint)
names(DelhiDataMaster) <- c("timeslots", "days", "date", "mW", "discom", "timepoint")
```

#####Since we now have a comprehensive dataset, time to share:

```{r}
write.csv(DelhiDataMaster, file = "DelhiDataMaster.csv")
```

####With the data now ready, it's time to parse with the goal of gathering datapoints that can be utilized for interesting graphs.
#####First, I set out to gather Delhi Peak and Low Energy usage spanning the entire 2010-2013 observation period.

```{r}
DailyPeak <-ddply(.data=DelhiDataMaster, .variables=.(date, discom), subset, mW=max(mW))
DailyLow <-ddply(.data=DelhiDataMaster, .variables=.(date, discom), subset, mW=min(mW))
OverallPeak <-ddply(.data=DelhiDataMaster, .variables=.(discom), subset, mW=max(mW))
OverallLow <-ddply(.data=DelhiDataMaster, .variables=.(discom), subset, mW=min(mW))
TotalPeakOccurence <-OverallPeak[grep("Total", OverallPeak$discom, ignore.case=T),]
BRPLPeakOccurence <-OverallPeak[grep("BRPL", OverallPeak$discom, ignore.case=T),]
BYPLPeakOccurence <-OverallPeak[grep("BYPL", OverallPeak$discom, ignore.case=T),]
MESPeakOccurence <-OverallPeak[grep("MES", OverallPeak$discom, ignore.case=T),]
NDMCPeakOccurence <-OverallPeak[grep("NDMC", OverallPeak$discom, ignore.case=T),]
NDPLPeakOccurence <-OverallPeak[grep("NDPL", OverallPeak$discom, ignore.case=T),]
TotalPeakDataA <-DelhiDataMaster[grep(TotalPeakOccurence$days, DelhiDataMaster$days,  ignore.case=T),]
TotalPeakData <-TotalPeakDataA[grep(TotalPeakOccurence$timepoint, TotalPeakDataA$timepoint,  ignore.case=T),]
BRPLPeakDataA <-DelhiDataMaster[grep(BRPLPeakOccurence$days, DelhiDataMaster$days,  ignore.case=T),]
BRPLPeakData <-BRPLPeakDataA[grep(BRPLPeakOccurence$timepoint, BRPLPeakDataA$timepoint,  ignore.case=T),]
BYPLPeakDataA <-DelhiDataMaster[grep(BYPLPeakOccurence$days, DelhiDataMaster$days,  ignore.case=T),]
BYPLPeakData <-BYPLPeakDataA[grep(BYPLPeakOccurence$timepoint, BYPLPeakDataA$timepoint,  ignore.case=T),]
MESPeakDataA <-DelhiDataMaster[grep(MESPeakOccurence$days, DelhiDataMaster$days,  ignore.case=T),]
MESPeakData <-MESPeakDataA[grep(MESPeakOccurence$timepoint, MESPeakDataA$timepoint,  ignore.case=T),]
NDMCPeakDataA <-DelhiDataMaster[grep(NDMCPeakOccurence$days, DelhiDataMaster$days,  ignore.case=T),]
NDMCPeakData <-NDMCPeakDataA[grep(NDMCPeakOccurence$timepoint, NDMCPeakDataA$timepoint,  ignore.case=T),]
NDPLPeakDataA <-DelhiDataMaster[grep(NDPLPeakOccurence$days, DelhiDataMaster$days,  ignore.case=T),]
NDPLPeakData <-NDPLPeakDataA[grep(NDPLPeakOccurence$timepoint, NDPLPeakDataA$timepoint,  ignore.case=T),]
```

##### Now we have all of the peak information. Time to start graphing.

#### Peak Power Consumption in Delhi

```{r}
TotalPeakDate <-toString(TotalPeakData$date)
TotalPeakData$mW <-round(TotalPeakData$mW, 0)
TotalPeakTitleText<-paste("Peak mW Consumption Observation on ",TotalPeakData$date, "at ",TotalPeakData$timeslots, Sep="")
ggplot(TotalPeakData, aes(y=mW ,x=reorder(discom,-mW), fill=discom)) + geom_bar(stat="identity", width=.75, alpha = 3/4) + ggtitle(TotalPeakTitleText) + ylab("mW by Distribution Company") + xlab("") + geom_text(aes(label = mW, y=mW+125, size=6)) + theme(legend.position="none")

```

#### Peak Power Consumption in Zones Served by BSES Rajdhani Power Limited (BRPL)

```{r}
BRPLPeakDate <-toString(BRPLPeakData$date)
BRPLPeakData$mW <-round(BRPLPeakData$mW, 0)
BRPLPeakTitleText<-paste("Peak mW Consumption Observation by BRPL on ",BRPLPeakData$date, "at ",BRPLPeakData$timeslots, Sep="")
ggplot(BRPLPeakData, aes(y=mW ,x=reorder(discom,-mW), fill=discom)) + geom_bar(stat="identity", width=.75, alpha = 3/4) + ggtitle(BRPLPeakTitleText) + ylab("mW by Distribution Company") + xlab("") + geom_text(aes(label = mW, y=mW+125, size=6)) + theme(legend.position="none")
```

#### Peak Power Consumption in Zones Served by BSES Yamuna Power Limited (BYPL)

```{r}
BYPLPeakDate <-toString(BYPLPeakData$date)
BYPLPeakData$mW <-round(BYPLPeakData$mW, 0)
BYPLPeakTitleText<-paste("Peak mW Consumption Observation by BYPL on ",BYPLPeakData$date, "at ",BYPLPeakData$timeslots, Sep="")
ggplot(BYPLPeakData, aes(y=mW ,x=reorder(discom,-mW), fill=discom)) + geom_bar(stat="identity", width=.75, alpha = 3/4) + ggtitle(BYPLPeakTitleText) + ylab("mW by Distribution Company") + xlab("") + geom_text(aes(label = mW, y=mW+125, size=6)) + theme(legend.position="none")
```

#### Peak Power Consumption in Zones Served by Military Engineering Service (MES)

```{r}
MESPeakDate <-toString(MESPeakData$date)
MESPeakData$mW <-round(MESPeakData$mW, 0)
MESPeakTitleText<-paste("Peak mW Consumption Observation by MES on ",MESPeakData$date, "at ",MESPeakData$timeslots, Sep="")
ggplot(MESPeakData, aes(y=mW ,x=reorder(discom,-mW), fill=discom)) + geom_bar(stat="identity", width=.75, alpha = 3/4) + ggtitle(MESPeakTitleText) + ylab("mW by Distribution Company") + xlab("") + geom_text(aes(label = mW, y=mW+125, size=6)) + theme(legend.position="none")
```

#### Peak Power Consumption in Zones Served by New Delhi Municipal Committee (NDMC)

```{r}
NDMCPeakDate <-toString(NDMCPeakData$date)
NDMCPeakData$mW <-round(NDMCPeakData$mW, 0)
NDMCPeakTitleText<-paste("Peak mW Consumption Observation by NDMC on ",NDMCPeakData$date, "at ",NDMCPeakData$timeslots, Sep="")
ggplot(NDMCPeakData, aes(y=mW ,x=reorder(discom,-mW), fill=discom)) + geom_bar(stat="identity", width=.75, alpha = 3/4) + ggtitle(NDMCPeakTitleText) + ylab("mW by Distribution Company") + xlab("") + geom_text(aes(label = mW, y=mW+125, size=6)) + theme(legend.position="none")
```

#### Peak Power Consumption in Zones Served by North Delhi Power Limited (NDPL)

```{r}
NDPLPeakDate <-toString(NDPLPeakData$date)
NDPLPeakData$mW <-round(NDPLPeakData$mW, 0)
NDPLPeakTitleText<-paste("Peak mW Consumption Observation by NDPL on ",NDPLPeakData$date, "at ",NDPLPeakData$timeslots, Sep="")
ggplot(NDPLPeakData, aes(y=mW ,x=reorder(discom,-mW), fill=discom)) + geom_bar(stat="identity", width=.75, alpha = 3/4) + ggtitle(NDPLPeakTitleText) + ylab("mW by Distribution Company") + xlab("") + geom_text(aes(label = mW, y=mW+125, size=6)) + theme(legend.position="none")
```

```{r}
#data2011 <- Source[which(Source$days<=40908, Source$days>=40544),c("days","timeslots","discom","mW","timepoint","date")]
#attach(data2011)
#d2011sorted <- data2011[order(discom,days,timepoint),]
```




